@if (isLoading() && !vehicle()) {
  <div class="mx-auto max-w-7xl px-4 py-16 sm:px-6 lg:px-8">
    <div class="h-6 w-40 rounded bg-slate-100 animate-pulse mb-4"></div>
    <div class="grid gap-8 lg:grid-cols-2">
      <div class="space-y-4">
        <div class="aspect-[4/3] rounded-2xl bg-slate-100 animate-pulse"></div>
        <div class="flex gap-2">
          <div class="h-16 w-24 rounded-lg bg-slate-100 animate-pulse"></div>
          <div class="h-16 w-24 rounded-lg bg-slate-100 animate-pulse"></div>
        </div>
      </div>
      <div class="space-y-3">
        <div class="h-4 w-24 rounded bg-slate-100 animate-pulse"></div>
        <div class="h-8 w-64 rounded bg-slate-100 animate-pulse"></div>
        <div class="h-6 w-32 rounded bg-slate-100 animate-pulse"></div>
        <div class="h-20 w-full rounded bg-slate-100 animate-pulse"></div>
      </div>
    </div>
  </div>
} @else if (vehicle(); as v) {
  <div class="mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8">
    <a routerLink="/vehicles" class="inline-flex items-center gap-1 text-sm font-semibold text-slate-500 hover:text-[#135bec]">
      <span class="material-symbols-outlined text-[18px]">arrow_back</span>
      Retour au marché
    </a>

    <div class="mt-6 grid gap-8 lg:grid-cols-2">
      <!-- Image gallery -->
      <div class="space-y-4">
        <div class="aspect-[4/3] overflow-hidden rounded-2xl bg-slate-100">
          <img
            [src]="v.imageUrls[currentImageIndex()] || v.imageUrls[0]"
            [alt]="v.brand + ' ' + v.model"
            class="h-full w-full object-cover"
          />
        </div>
        @if (v.imageUrls.length > 1) {
          <div class="flex gap-2 overflow-x-auto">
            @for (img of v.imageUrls; track $index) {
              <button
                type="button"
                (click)="setImageIndex($index)"
                class="shrink-0 h-16 w-24 rounded-lg overflow-hidden border-2"
                [class.border-[#135bec]]="currentImageIndex() === $index"
                [class.border-transparent]="currentImageIndex() !== $index"
              >
                <img [src]="img" alt="" class="h-full w-full object-cover" />
              </button>
            }
          </div>
        }
      </div>

      <!-- Specs + CTA -->
      <div>
        @if (v.badge) {
          <span
            class="inline-block rounded-full px-3 py-1 text-xs font-semibold text-white mb-4"
            [ngClass]="{ 'bg-emerald-500': v.badge === 'Nouveau', 'bg-amber-500': v.badge === 'Bon prix' }"
          >
            {{ v.badge }}
          </span>
        }
        <h1 class="text-2xl font-bold text-slate-900 md:text-3xl">{{ v.brand }} {{ v.model }}</h1>
        <p class="mt-2 text-3xl font-bold text-[#135bec]">{{ formatPrice(v.price) }}</p>
        <div class="mt-6 grid grid-cols-2 gap-3 text-sm">
          <div class="rounded-xl border border-slate-100 p-3">
            <p class="text-slate-500">Année</p>
            <p class="font-semibold text-slate-900">{{ v.year }}</p>
          </div>
          <div class="rounded-xl border border-slate-100 p-3">
            <p class="text-slate-500">Kilométrage</p>
            <p class="font-semibold text-slate-900">{{ v.mileageKm | number }} km</p>
          </div>
          <div class="rounded-xl border border-slate-100 p-3">
            <p class="text-slate-500">Carburant</p>
            <p class="font-semibold text-slate-900">{{ v.fuelType }}</p>
          </div>
          <div class="rounded-xl border border-slate-100 p-3">
            <p class="text-slate-500">Boîte</p>
            <p class="font-semibold text-slate-900">{{ v.gearbox }}</p>
          </div>
          <div class="rounded-xl border border-slate-100 p-3 col-span-2">
            <p class="text-slate-500">Localisation</p>
            <p class="font-semibold text-slate-900 flex items-center gap-1">
              <span class="material-symbols-outlined text-[18px]">location_on</span>
              {{ v.location }}
            </p>
          </div>
        </div>
        <p class="mt-6 text-slate-600">{{ v.description }}</p>
        <div class="mt-8 flex flex-wrap gap-3">
          <a
            routerLink="/contact"
            class="inline-flex items-center gap-2 rounded-xl bg-[#135bec] px-6 py-3 text-sm font-semibold text-white shadow-lg shadow-blue-200/50 hover:bg-blue-700"
          >
            <span class="material-symbols-outlined text-[18px]">contact_phone</span>
            Contacter le vendeur
          </a>
          <a
            routerLink="/auth/register"
            class="inline-flex items-center gap-2 rounded-xl border border-slate-200 px-6 py-3 text-sm font-semibold text-slate-700 hover:bg-slate-50"
          >
            Faire une offre
          </a>
        </div>
      </div>
    </div>

    <!-- Similar vehicles -->
    @if (isSimilarLoading()) {
      <div class="mt-16">
        <h2 class="text-xl font-bold text-slate-900">Véhicules similaires</h2>
        <div class="mt-6 grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
          @for (s of [1, 2, 3, 4]; track s) {
            <div class="flex flex-col rounded-2xl border border-slate-100 bg-white shadow-sm overflow-hidden animate-pulse">
              <div class="aspect-[4/3] bg-slate-100"></div>
              <div class="p-4 space-y-2">
                <div class="h-4 w-2/3 rounded bg-slate-100"></div>
                <div class="h-3 w-1/2 rounded bg-slate-100"></div>
                <div class="h-5 w-20 rounded bg-slate-100 mt-2"></div>
              </div>
            </div>
          }
        </div>
      </div>
    } @else if (similarVehicles().length > 0) {
      <div class="mt-16">
        <h2 class="text-xl font-bold text-slate-900">Véhicules similaires</h2>
        <div class="mt-6 grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
          @for (s of similarVehicles(); track s.id) {
            <a
              [routerLink]="['/vehicles', s.id]"
              class="group flex flex-col rounded-2xl border border-slate-100 bg-white shadow-sm overflow-hidden hover:shadow-md"
            >
              <div class="aspect-[4/3] bg-slate-100">
                <img [src]="s.imageUrls[0]" [alt]="s.brand + ' ' + s.model" class="h-full w-full object-cover" />
              </div>
              <div class="p-4">
                <h3 class="font-semibold text-slate-900 group-hover:text-[#135bec]">{{ s.brand }} {{ s.model }}</h3>
                <p class="mt-1 text-sm text-slate-500">{{ s.year }} · {{ s.mileageKm | number }} km</p>
                <p class="mt-2 text-lg font-bold text-[#135bec]">{{ formatPrice(s.price) }}</p>
              </div>
            </a>
          }
        </div>
      </div>
    }
  </div>
} @else {
  <div class="mx-auto max-w-7xl px-4 py-16 text-center">
    <p class="text-slate-500">Véhicule non trouvé.</p>
    <a routerLink="/vehicles" class="mt-4 inline-flex items-center gap-1 text-[#135bec] font-semibold">
      Retour au marché
      <span class="material-symbols-outlined text-[18px]">arrow_forward</span>
    </a>
  </div>
}
