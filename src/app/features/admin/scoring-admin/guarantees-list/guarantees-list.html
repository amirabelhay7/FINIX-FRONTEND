<div class="guarantees-admin-page">
  <header class="guarantees-header">
    <div class="guarantees-header-left">
      <div class="guarantees-header-icon-wrap">
        <span class="material-symbols-outlined">handshake</span>
      </div>
      <div>
        <h1 class="guarantees-title">{{ pageTitle }}</h1>
        <p class="guarantees-subtitle">{{ pageSubtitle }}</p>
      </div>
    </div>
    <a routerLink="/admin/scoring/guarantees/create" class="guarantees-header-btn">
      <span class="material-symbols-outlined">add</span>
      Create guarantee
    </a>
  </header>

  <div *ngIf="loading" class="guarantees-loading">
    <span class="material-symbols-outlined">progress_activity</span>
    <p>Loading guaranteesâ€¦</p>
  </div>

  <div *ngIf="!loading && error" class="guarantees-error">
    <span class="material-symbols-outlined">error</span>
    <p>{{ error }}</p>
    <button type="button" class="guarantees-retry" (click)="loadGuarantees()">Retry</button>
  </div>

  <ng-container *ngIf="!loading && !error">
    <div class="guarantees-stats">
      <div class="guarantees-stat">
        <p class="guarantees-stat-value">{{ guarantees.length }}</p>
        <p class="guarantees-stat-label">Total</p>
      </div>
      <div class="guarantees-stat">
        <p class="guarantees-stat-value">{{ acceptedCount }}</p>
        <p class="guarantees-stat-label">Accepted</p>
      </div>
      <div class="guarantees-stat">
        <p class="guarantees-stat-value">{{ pendingCount }}</p>
        <p class="guarantees-stat-label">Pending</p>
      </div>
    </div>

    <div class="guarantees-card">
      <div class="guarantees-toolbar">
        <div class="guarantees-search-wrap">
          <span class="material-symbols-outlined">search</span>
          <input type="text" [(ngModel)]="searchText" [placeholder]="searchPlaceholder" class="guarantees-search-input" />
        </div>
        <select [(ngModel)]="statusFilter" class="guarantees-filter-select">
          <option *ngFor="let opt of statusFilterOptions" [value]="opt.value">{{ opt.label }}</option>
        </select>
      </div>
      <div class="guarantees-table-wrap">
        <table class="guarantees-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Guarantor</th>
              <th>Beneficiary</th>
              <th>Points</th>
              <th>Created</th>
              <th>Accepted</th>
              <th class="text-right">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of filteredRows">
              <td class="guarantees-cell-id">{{ row.id }}</td>
              <td class="guarantees-cell-guarantor">{{ row.guarantor }}</td>
              <td>{{ row.beneficiary }}</td>
              <td class="guarantees-cell-points">{{ row.points }}</td>
              <td>{{ row.created }}</td>
              <td>
                <span class="guarantees-pill" [ngClass]="row.accepted === 'Yes' ? 'guarantees-pill-accepted' : 'guarantees-pill-pending'">{{ row.accepted }}</span>
              </td>
              <td>
                <div class="guarantees-actions">
                  <a [routerLink]="row.viewRoute" class="guarantees-action-link">{{ viewLabel }}</a>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <p *ngIf="filteredRows.length === 0" class="guarantees-empty">No guarantees match your filters.</p>
    </div>
  </ng-container>
</div>
