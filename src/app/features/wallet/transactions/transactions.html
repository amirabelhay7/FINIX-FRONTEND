<div class="space-y-8 animate-in fade-in duration-700 pb-10">
    <p *ngIf="error" class="text-red-600 text-sm font-medium">{{ error }}</p>
    <div *ngIf="loading" class="py-12 text-center text-gray-500 font-medium">Loading transactions…</div>

    <div *ngIf="!loading && !error" class="flex flex-col md:flex-row md:items-center justify-between gap-4">
        <div>
            <h1 class="text-3xl font-extrabold text-gray-900 tracking-tight">{{ pageTitle }}</h1>
            <p class="text-gray-500 text-sm font-medium">{{ pageSubtitle }}</p>
        </div>
        <button type="button" class="px-4 py-2 bg-white border border-gray-200 rounded-lg text-sm font-bold text-gray-600 hover:bg-gray-50 transition-all flex items-center shadow-sm" (click)="onExportCsv()">
            <span class="material-symbols-outlined mr-2 text-[18px]">download</span>Export CSV
        </button>
    </div>

    <div *ngIf="!loading && !error" class="grid grid-cols-1 sm:grid-cols-4 gap-4">
        <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm">
            <p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest mb-1">Total In</p>
            <p class="text-xl font-black text-green-600">{{ kpis.totalIn }}</p>
        </div>
        <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm">
            <p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest mb-1">Total Out</p>
            <p class="text-xl font-black text-red-500">{{ kpis.totalOut }}</p>
        </div>
        <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm">
            <p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest mb-1">Net (30d)</p>
            <p class="text-xl font-black text-gray-800">{{ kpis.net }}</p>
        </div>
        <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm">
            <p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest mb-1">Transactions</p>
            <p class="text-xl font-black text-gray-800">{{ kpis.count }} <span class="text-sm font-normal text-gray-400">{{ kpis.countLabel }}</span></p>
        </div>
    </div>

    <!-- Empty state when no transactions -->
    <div *ngIf="!loading && !error && transactions.length === 0" class="bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden">
        <div class="flex flex-col items-center justify-center py-16 px-6 text-center">
            <span class="material-symbols-outlined text-5xl text-gray-200 mb-4">receipt_long</span>
            <h3 class="text-lg font-bold text-gray-800 mb-1">No transactions yet</h3>
            <p class="text-sm text-gray-500 mb-6 max-w-sm">Your transaction history will appear here after you deposit, withdraw, or transfer.</p>
            <a routerLink="/wallet" class="inline-flex items-center gap-2 px-4 py-2 bg-[#135bec] text-white rounded-lg text-sm font-bold hover:bg-blue-700 transition-colors">
                <span class="material-symbols-outlined text-[18px]">account_balance_wallet</span>
                Back to wallet
            </a>
        </div>
    </div>

    <!-- Table when there are transactions -->
    <div *ngIf="!loading && !error && transactions.length > 0" class="bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden">
        <div class="p-5 border-b border-gray-50 flex flex-wrap items-center gap-3">
            <div class="flex items-center bg-gray-50 rounded-lg border border-gray-200 px-3 py-2">
                <span class="material-symbols-outlined text-gray-400 text-[18px] mr-2">search</span>
                <input type="text" [(ngModel)]="filterSearch" (ngModelChange)="currentPage = 1" placeholder="Search transactions..." class="text-sm font-medium text-gray-800 bg-transparent outline-none placeholder-gray-400 w-48" />
            </div>
            <select class="text-xs font-bold text-gray-500 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 focus:outline-none focus:border-[#135bec]" [(ngModel)]="filterType" (ngModelChange)="currentPage = 1">
                <option value="">All Types</option>
                <option value="DEPOSIT">Deposit</option>
                <option value="WITHDRAWAL">Withdrawal</option>
                <option value="TRANSFER">Transfer</option>
                <option value="AGENT_TOP_UP">Agent top-up</option>
            </select>
            <select class="text-xs font-bold text-gray-500 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 focus:outline-none focus:border-[#135bec]" [(ngModel)]="filterDateRange" (ngModelChange)="currentPage = 1">
                <option value="all">All time</option>
                <option value="7">Last 7 days</option>
                <option value="30">Last 30 days</option>
                <option value="90">Last 3 months</option>
            </select>
            <select class="text-xs font-bold text-gray-500 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 focus:outline-none focus:border-[#135bec]" [(ngModel)]="filterStatus" (ngModelChange)="currentPage = 1">
                <option value="">All status</option>
                <option value="Success">Success</option>
                <option value="PENDING">Pending</option>
                <option value="FAILED">Failed</option>
            </select>
        </div>

        <div class="overflow-x-auto">
            <table class="w-full text-left">
                <thead>
                    <tr class="bg-gray-50/50 text-gray-400 text-[10px] uppercase font-bold tracking-widest">
                        <th class="px-6 py-4">TX Ref</th>
                        <th class="px-6 py-4">Type</th>
                        <th class="px-6 py-4">Description</th>
                        <th class="px-6 py-4">Amount</th>
                        <th class="px-6 py-4">Status</th>
                        <th class="px-6 py-4 text-right">Date</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-50 text-sm font-medium">
                    <tr *ngIf="getPaginatedTransactions().length === 0" class="bg-gray-50/50">
                        <td colspan="6" class="px-6 py-8 text-center text-gray-500 text-sm">No transactions match your filters.</td>
                    </tr>
                    <tr [routerLink]="tx.id ? ['/wallet/transactions', tx.id] : null" [class.cursor-pointer]="tx.id" class="hover:bg-gray-50/50 transition-colors" *ngFor="let tx of getPaginatedTransactions()">
                        <td class="px-6 py-4 font-mono text-[10px] text-gray-400">{{ tx.ref }}</td>
                        <td class="px-6 py-4"><span class="px-2 py-0.5 text-[10px] rounded border font-bold" [ngClass]="tx.typeClass">{{ tx.type }}</span></td>
                        <td class="px-6 py-4 text-gray-600 font-medium text-xs">{{ tx.description }}</td>
                        <td class="px-6 py-4 font-black" [ngClass]="tx.amountPositive ? 'text-green-600' : 'text-red-500'">{{ tx.amount }}</td>
                        <td class="px-6 py-4"><span class="flex items-center text-xs font-bold" [ngClass]="tx.statusTextClass"><span class="w-1.5 h-1.5 rounded-full mr-2" [ngClass]="tx.statusDotClass"></span>{{ tx.status }}</span></td>
                        <td class="px-6 py-4 text-right text-xs text-gray-400 font-medium">{{ tx.date }}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="px-6 py-4 border-t border-gray-50 flex flex-wrap items-center justify-between gap-3">
            <div class="flex items-center gap-4">
                <p class="text-xs text-gray-400 font-medium">{{ paginationRange }} transaction(s)</p>
                <select class="text-xs font-bold text-gray-500 bg-gray-50 border border-gray-200 rounded-lg px-2 py-1.5 focus:outline-none focus:border-[#135bec]" [ngModel]="pageSize" (ngModelChange)="pageSize = $event; onPageSizeChange()">
                    <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }} per page</option>
                </select>
            </div>
            <div class="flex items-center space-x-1">
                <button type="button" class="w-8 h-8 flex items-center justify-center rounded-lg transition-colors disabled:opacity-40 disabled:cursor-not-allowed" [class.text-gray-400]="currentPage > 1" [class.hover:bg-gray-100]="currentPage > 1" [class.text-gray-300]="currentPage <= 1" [disabled]="currentPage <= 1" (click)="goToPage(currentPage - 1)">
                    <span class="material-symbols-outlined text-[18px]">chevron_left</span>
                </button>
                <ng-container *ngFor="let p of getPageNumbers()">
                    <button *ngIf="p !== -1" type="button" class="w-8 h-8 flex items-center justify-center rounded-lg text-xs font-bold transition-colors" [class.text-white]="p === currentPage" [class.bg-[#135bec]]="p === currentPage" [class.text-gray-500]="p !== currentPage" [class.hover:bg-gray-100]="p !== currentPage" (click)="goToPage(p)">{{ p }}</button>
                    <span *ngIf="p === -1" class="w-8 h-8 flex items-center justify-center text-gray-400 text-xs">…</span>
                </ng-container>
                <button type="button" class="w-8 h-8 flex items-center justify-center rounded-lg transition-colors disabled:opacity-40 disabled:cursor-not-allowed" [class.text-gray-400]="currentPage < totalPages" [class.hover:bg-gray-100]="currentPage < totalPages" [class.text-gray-300]="currentPage >= totalPages" [disabled]="currentPage >= totalPages" (click)="goToPage(currentPage + 1)">
                    <span class="material-symbols-outlined text-[18px]">chevron_right</span>
                </button>
            </div>
        </div>
    </div>

</div>
