<div class="backoffice">
  <!-- Sidebar -->
  <aside class="backoffice-sidebar" [class.is-open]="isSidebarOpen()">
    <div class="sidebar-brand">
      <a routerLink="/admin/dashboard" class="brand-link">
        <span class="brand-icon material-symbols-outlined">account_balance</span>
        <span class="brand-text">FINIX</span>
      </a>
    </div>

    <nav class="sidebar-nav">
      @for (item of menuItems; track item.label) {
        <a [routerLink]="item.path" routerLinkActive="nav-item-active"
           [routerLinkActiveOptions]="item.exact ? { exact: true } : { exact: false }" #rla="routerLinkActive"
           (click)="closeSidebarOnMobile()"
           class="nav-item">
          <span class="nav-icon material-symbols-outlined">{{ item.icon }}</span>
          <span class="nav-label">{{ item.label }}</span>
        </a>
      }
    </nav>

    <div class="sidebar-footer">
      <button type="button" (click)="logout()" class="sidebar-logout">
        <span class="material-symbols-outlined">logout</span>
        Log out
      </button>
    </div>
  </aside>

  <!-- Main: top bar + content -->
  <div class="backoffice-main">
    <header class="topbar">
      <div class="topbar-left">
        <button type="button" (click)="toggleSidebar()" class="topbar-menu-btn"
                aria-label="Toggle menu">
          <span class="material-symbols-outlined">menu</span>
        </button>
        <div class="topbar-search">
          <span class="material-symbols-outlined search-icon">search</span>
          <input type="text" placeholder="Searchâ€¦" class="search-input" />
        </div>
      </div>

      <div class="topbar-right">
        <div class="topbar-notifications">
          <button type="button" (click)="toggleNotificationPanel()" class="topbar-icon-btn"
                  aria-label="Notifications">
            <span class="material-symbols-outlined">notifications</span>
            @if (unreadCount > 0) {
              <span class="notification-badge">{{ unreadCount > 99 ? '99+' : unreadCount }}</span>
            }
          </button>
          @if (showNotificationPanel) {
            <div class="notifications-panel">
              <div class="notifications-panel-header">
                <span class="notifications-panel-title">Notifications</span>
                @if (unreadCount > 0) {
                  <button type="button" (click)="markAllNotificationsRead()" class="notifications-mark-read">Mark all read</button>
                }
              </div>
              <div class="notifications-list">
                @for (n of notifications; track n.id) {
                  <button type="button" (click)="markAsRead(n); showNotificationPanel = false"
                          class="notification-item" [class.unread]="!n.read">
                    <p class="notification-title">{{ n.title }}</p>
                    <p class="notification-message">{{ n.message }}</p>
                    <p class="notification-time">{{ formatNotificationTime(n.createdAt) }}</p>
                  </button>
                }
              </div>
              @if (notifications.length === 0) {
                <p class="notifications-empty">No notifications yet.</p>
              }
            </div>
          }
        </div>
        <div class="topbar-divider"></div>
        <div class="topbar-user-wrap">
          <button type="button" (click)="toggleUserMenu()" class="topbar-user-btn">
            <img [src]="userAvatarUrl" alt="" class="topbar-avatar" />
            <div class="topbar-user-info">
              <span class="topbar-user-name">{{ currentUser?.firstName }} {{ currentUser?.lastName }}</span>
              <span class="topbar-user-role">Admin</span>
            </div>
            <span class="material-symbols-outlined topbar-user-chevron">expand_more</span>
          </button>
          @if (showUserMenu) {
            <div class="user-menu">
              <div class="user-menu-header">
                <p class="user-menu-email">{{ currentUser?.email }}</p>
                <p class="user-menu-name">{{ currentUser?.firstName }} {{ currentUser?.lastName }}</p>
              </div>
              <button type="button" (click)="logout()" class="user-menu-logout">
                <span class="material-symbols-outlined">logout</span>
                Log out
              </button>
            </div>
          }
        </div>
      </div>
    </header>

    <main class="backoffice-content">
      <div class="backoffice-content-inner">
        <router-outlet></router-outlet>
      </div>
    </main>
  </div>
</div>
